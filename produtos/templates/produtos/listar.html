<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">

<h2>Lista de Produtos</h2>

<a href="{% url 'adicionar_produto' %}">Adicionar novo produto</a>
<br><br>

<form method="GET" class="mb-3" id="filtroForm">

    <select name="categoria" id="filtroCategoria">
        <option value="">-- Todas categorias --</option>
        {% for c in categorias %}
            <option value="{{ c.id }}" 
                {% if categoria_filtro == c.id|stringformat:"s" %}selected{% endif %}>
                {{ c.nome }}
            </option>
        {% endfor %}
    </select>

    <input type="text" name="busca" id="filtroBusca" placeholder="Pesquisar..."
           value="{{ termo|default:'' }}">

    <button type="submit" id="btnFiltrar" disabled>Filtrar</button>

    <label>Ordenar por:</label>
        <select name="ordem">
            <option value="">-- nenhum --</option>
            <option value="az" {% if ordem == 'az' %}selected{% endif %}>Nome A → Z</option>
            <option value="za" {% if ordem == 'za' %}selected{% endif %}>Nome Z → A</option>
            <option value="menor_preco" {% if ordem == 'menor_preco' %}selected{% endif %}>Preço menor → maior</option>
            <option value="maior_preco" {% if ordem == 'maior_preco' %}selected{% endif %}>Preço maior → menor</option>
        </select>

</form>

<script>
    const categoria = document.getElementById("filtroCategoria");
    const busca = document.getElementById("filtroBusca");
    const botao = document.getElementById("btnFiltrar");

    function atualizarBotao() {
        if (categoria.value === "" && busca.value.trim() === "") {
            botao.disabled = true;   
        } else {
            botao.disabled = false;  
        }
    }

    categoria.addEventListener("change", atualizarBotao);
    busca.addEventListener("input", atualizarBotao);

    atualizarBotao(); 
</script>


<table border="1" cellpadding="8">
    <tr>
        <th>Foto</th>
        <th>Nome</th>
        <th>Preço</th>
        <th>Disponível</th>
        <th>Ações</th>
    </tr>

    {% for p in produtos %}
    <tr>
        <td>
            {% if p.foto %}
                <img src="{{ p.foto.url }}" width="80">
            {% else %}
                Sem foto
            {% endif %}
        </td>

        <td>{{ p.nome }}</td>
        <td>R$ {{ p.preco }}</td>
        <td>{{ p.disponibilidade }}</td>

        <td>
            <a href="{% url 'editar_produto' p.id %}">Editar</a> |
            <a href="{% url 'excluir_produto' p.id %}">Excluir</a>
        </td>
    </tr>
    {% endfor %}
</table>
<a href="{% url 'listar_produto' %}" class="btn btn-secondary mt-2">Voltar</a>